# CausalImpact

## 패키지 소개 요약

### CausalImpact는 무엇일까?

- 시계열 데이터에서 의도적인 개입으로 인한 인과 효과를 추정하기 위한 방법론이다.
- "광고 캠페인을 적용했을 때 일별 클릭수는 얼마나 증가했을까?" 같은 질문은 실험이 불가능한 상황에서 답변하는 것이 매우 어렵다.

### 어떻게 동작할까?

- 결과 변수에 해당하는 시계열과 (예. 클릭수) 통제 변수에 해당하는 시계열 (예. 개입이 적용되지 않은 영역의 클릭수 또는 다른 사이트의 클릭수)가 주어졌을 때, Bayesian Structural time-series model 을 구축한다.
- 학습한 시계열 모형을 통해 counterfactual 을 예측하다. 다시 말해, 만약 특정 시점에 개입이 일어나지 않았다면 그 이후에 지표가 어떻게 되었을지를 예측한다.

### 모형이 어떤 가정을 하고 있을까?

1. 통제 변수(Control) 역할을 하는 시계열은 개입의 영향을 받지 않아야 한다.
2. 개입 이전 시점의 공변량과 결과 변수의 관계가 개입 이후에도 유지되어야 한다.
    - 이 가정을 완화시키고 싶을 경우 dynamic regression 을 추가로 적용할 수 있다.
3. 모형에 Prior가 포함되어 있다는 사실을 명심해야 한다.
    - CausalImpact가 기본적으로 시계열 학습에 사용하는 모형은 Local Level 을 위해 Gaussian random walk 를 사용하는데, 이 때 random walk의 표준 편차에 Prior가 설정되어 있다.

### 모형의 가정을 만족하는지 어떻게 확인할 수 있을까?

다음과 같은 방법으로 시작해보자.

1. 왜 모형에 포함된 공변량들이 개입의 영향을 받지 않았는지 고민해야 한다.
    - 모든 공변량을 그래프로 그려서 시각적으로 확인해 볼 필요도 있다.
2. 개입 이전 시점까지의 시계열을 얼마나 잘 예측하는지 확인해야 한다. 임의의 시점에 가상의 개입이 이루어졌다고 가정하고 모형을 학습하면 어떤 결론이 나오는지 확인해본다. 이 때 counterfactual 예측과 실제값이 비슷해서 통계적으로 유의미하지 않은 결론이 나와야 한다.
3. 모형의 학습 결과를 공유할 때는 가정한 내용들과 모형의 파라미터를 포함하여 공유한다. 다른 사람들과 함께 유효한 가정인지, 적절한 파라미터를 사용한 것인지 논의하는 것이 좋다.

## 논문 요약

- 신제품 출시나 광고 캠페인의 시작/종료 등 특정 시점에 발생한 마케팅 이벤트가 목표로 하는 지표에 미친 영향을 측정하고자 한다.
    - 지금은 목표로 하는 결과 변수가 시계열이기 때문에, 우리가 알고자 하는 인과 효과는 관측된 시계열과 개입이 발생하지 않았을 때의 시계열의 차이가 된다.
- 개입이 발생하지 않았을 경우를 예측하기 위해 사용할 수 있는 접근법으로 여러 예측 변수를 모아 하나의 가상 통제군 데이터를 추정하는 방식이 있다.
    - 가상의 통제군을 만들기 위해서는 크게 세가지 정보가 필요하다.
        - (1) 결과 변수 시계열 (개입 이전)
        - (2) 결과 변수를 예측하는데 도움이 되는 다른 시계열 (개입 이전)
        - (3) 적절한 모형 파라미터를 위한 Prior (베이지안 모형을 사용할 경우)
    - 위 세 가지 정보를 모아 state-space 시계열 모형을 구성한다.
